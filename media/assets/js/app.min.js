/*! genitaliame 2014-11-26 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c,d=function(a,b){return function(){return a.apply(b,arguments)}};c=function(){function a(a,b){this.onResize=d(this.onResize,this),this.zoomOut=d(this.zoomOut,this),this.zoomIn=d(this.zoomIn,this),this.onPhotoClick=d(this.onPhotoClick,this),this.onWallMouseDragged=d(this.onWallMouseDragged,this),this.onWallMouseUp=d(this.onWallMouseUp,this),this.onWallMouseDown=d(this.onWallMouseDown,this),this.createDOMPhotos=d(this.createDOMPhotos,this),this.setup=d(this.setup,this);var c,e,f;this.size=b,f=[this.size[0],this.size[1]],e=f[0],c=f[1],this.photoJSONList=[],this.photosDOMList=[],this.inZoom=!1,this.container=$jQ(a),this.onResize()}return a.prototype.setup=function(a,b,c){var d;return this.photoJSONList=a,this.imgCounter=Math.floor(Math.random()*(this.photoJSONList.length-1)),window.addEventListener("resize",$jQ.debounce(100,this.onResize),!1),$jQ("#wall").on("mouseup",".tile",function(a){return function(b,c){return a.dragged?void 0:a.onPhotoClick(b,c)}}(this)),this.wall=new Wall("wall",{draggable:!0,scrollable:!0,width:120,height:180,speed:800,inertia:!0,inertiaSpeed:.93,printCoordinates:!1,rangex:[-50,50],rangey:[-50,50],callOnUpdate:function(a){return function(b){return 0!==b.length?a.createDOMPhotos(b):void 0}}(this),callOnMouseDown:this.onWallMouseDown,callOnMouseUp:this.onWallMouseUp,callOnMouseDragged:this.onWallMouseDragged}),this.wall.initWall(),b=null!=b?b:$jQ.noop,c=null!=c?c:$jQ.noop,d=$jQ("#wall").imagesLoaded().always(function(a,b){return c(a,b)}).progress(function(a,c){return b(a,c)})},a.prototype.createDOMPhotos=function(a){return a.each(function(a){return function(b){var c,d;return"random"===PHOTO_TILING?a.imgCounter=Math.floor(Math.random()*a.photoJSONList.length):"sequential"===PHOTO_TILING&&(a.imgCounter=(a.photoJSONList.length-1+a.imgCounter++)%a.photoJSONList.length),c=a.photoJSONList[a.imgCounter],d=new Element("img[src='"+c.url_small+"']"),d.inject(b.node),$jQ(b.node).imagesLoaded(function(){return $jQ(d).addClass("loaded")}),$jQ(d).data("photo_info",c)}}(this))},a.prototype.onWallMouseDown=function(){console.log("mouseDown"),this.dragged=!1},a.prototype.onWallMouseUp=function(){return console.log("mouseUp"),this.dragged=!1,!1},a.prototype.onWallMouseDragged=function(a){return Math.abs(a[0])>5||Math.abs(a[1])>5?(this.dragged=!0,!0):!1},a.prototype.onPhotoClick=function(a){return console.log("photoClick"),this.cTarget=$jQ(a.target),this.inZoom&&this.cTarget.attr("src")===this.prevTarget.attr("src")?this.zoomOut():this.zoomIn(this.cTarget)},a.prototype.zoomIn=function(a){return this.prevTarget=this.cTarget,this.inZoom=!0,$jQ(a).imagesLoaded(function(){}),$jQ(a).attr("src",$jQ(a).data("photo_info").url),$jQ(a).zoomTo({targetSize:.75,duration:600})},a.prototype.zoomOut=function(){return this.inZoom=!1,$jQ("body").zoomTo({targetSize:.75,duration:600})},a.prototype.onResize=function(){var a,b,c;return c=[window.innerWidth,window.innerHeight],b=c[0],a=c[1],$jQ(this.container).css({width:b,height:a}),$jQ("#overlay").css({width:b,height:a})},a}(),b.exports=c},{}],2:[function(a,b){var c,d,e,f,g;c=a("./app4.coffee"),e=a("./overlay/manager.coffee"),d=a("./loader.coffee"),f=function(){var a,b,f,g,h,i,j;return i=new e("#overlay"),i.hide(),f=new d("#loading"),f.loading(),a=new c("#viewport",[window.innerWidth,window.innerHeight]),b=$jQ("#menu"),b.show(),j=50,g=function(a,b){return b.length>j?f.complete():void 0},h=function(){return f.complete()},$jQ.getJSON(API_URL,function(){return function(b){return a.setup(b,g,h)}}(this)),$jQ("#menu-mostraoteu").on("click",function(a){return i.on?i.hide():(i.setPage("mostraoteu"),i.show()),a.stopPropagation(),!1}),window.loader=f,window.overlay=i,window.banco=a,window.menu=b,window.$jQ=$jQ},b.exports.init=f,window.API_URL="/photos/json",window.API_SUBMIT_PHOTO="/photos/upload",window.API_VERIFY_PHOTO="/photos/verify",window.WIDTH=window.innerWidth,window.HEIGHT=window.innerHeight,window.PHOTO_TILING="sequential",$.fx.speeds._default=500,document.addEventListener("DOMContentLoaded",function(){return window.$jQ=$,$.noConflict(),f()}),g=function(){return console.log("Openbooth loaded"),setTimeout(function(){return window.overlay.getController("photobooth").embedComplete()},500)}},{"./app4.coffee":1,"./loader.coffee":3,"./overlay/manager.coffee":6}],3:[function(a,b){var c,d=function(a,b){return function(){return a.apply(b,arguments)}};c=function(){function a(a){this.complete=d(this.complete,this),this.loading=d(this.loading,this),this.el=$jQ(a)}return a.prototype.loading=function(){return $jQ(this.el).css({opacity:.8}).show().queue(function(a){return function(){return a.loadingAnimation(),$jQ(a.el).transition({opacity:1}).dequeue()}}(this))},a.prototype.loadingAnimation=function(){var a,b;return a=["Loading .","Loading ..","Loading ..."],b=0,this.load_id=setInterval(function(c){return function(){return b=++b%a.length,$jQ(c.el).children("p").text(a[b])}}(this),200)},a.prototype.complete=function(){return clearInterval(this.load_id),$jQ(this.el).transition({opacity:0}).queue(function(a){return function(){return $jQ(a.el).hide().dequeue()}}(this))},a}(),b.exports=c},{}],4:[function(a,b){var c,d=function(a,b){return function(){return a.apply(b,arguments)}};c=function(){function a(a,b){this.parent=a,this.el=b,this.photoSubmitError=d(this.photoSubmitError,this),this.photoSubmitSuccess=d(this.photoSubmitSuccess,this),this.photoSubmitProgress=d(this.photoSubmitProgress,this),this.stopProgressBar=d(this.stopProgressBar,this),this.startProgressBar=d(this.startProgressBar,this),this.submitPicture=d(this.submitPicture,this),this.thumbnail=d(this.thumbnail,this),this.createThumb=d(this.createThumb,this),this.on_hide_complete=d(this.on_hide_complete,this),this.on_show_complete=d(this.on_show_complete,this),this.stop=d(this.stop,this),this.start=d(this.start,this),this.delta=250,this.opts=["8=>         ","8==>        ","8===>       ","8=====>     ","8=======>  o","8======>    ","8===>       ","8==>        ","8>          "],this.idx=0,window.upinterval=null}return a.prototype.start=function(){return $jQ("#photo-submit",this.el).dropzone({url:window.API_VERIFY_PHOTO,paramName:"photo",createImageThumbnails:!0,thumbnailWidth:300,thumbnailHeight:450,previewTemplate:'<div class"preview file-preview"></div>',parallelUploads:1,acceptedFiles:"image/*"}),this.dropzone=$jQ("#photo-submit").data("dropzone"),this.dropzone.on("dragenter",this.dragEnter),this.dropzone.on("dragleave",this.dragLeave),this.dropzone.on("drop",this.dragLeave),this.dropzone.on("thumbnail",this.thumbnail),this.setupEvents()},a.prototype.stop=function(){},a.prototype.on_show_complete=function(){},a.prototype.on_hide_complete=function(){},a.prototype.setupEvents=function(){return $jQ("#photo-submit #bt-file").bind("click",function(a){return function(){return a.showDialog()}}(this)),$jQ("#bt-cancel-photo",this.el).on("click",function(){return function(a){return overlay.hide(),a.stopPropagation()}}(this)),$jQ("#bt-submit-photo").on("click",function(a){return function(){return a.upprogress?void 0:(0===$jQ("#photo-submit").data("dropzone").files.length&&a.showDialog(),a.submitPicture())}}(this))},a.prototype.showDialog=function(){return $jQ("#photo-submit").click()},a.prototype.dragEnter=function(){return $jQ("#photo-submit").addClass("drag")},a.prototype.dragLeave=function(){return $jQ("#photo-submit").removeClass("drag")},a.prototype.createThumb=function(a){var b;return b=new FileReader,b.onload=function(c){return function(){var d;return d=new Image,d.onload=function(){var b,e,f,g,h;return b=document.createElement("canvas"),e=b.getContext("2d"),h=d.width,f=d.height,e.drawImage(d,0,0,h,f,0,0,h,f),g=b.toDataURL("image/png"),c.dropzone.emit("thumbnail",a,g)},d.src=b.result}}(this),b.readAsDataURL(a)},a.prototype.thumbnail=function(a,b){var c;return $jQ(".message","#photo-submit").hide(),c=new Image,c.src=b,$jQ(c).bind("click",this.showDialog),$jQ("img","#photo-submit").length?$jQ("img","#photo-submit").attr({src:b}):$jQ("#photo-submit").append(c)},a.prototype.submitPicture=function(){var a,b,c,d,e;return b=$jQ("#photo-submit").data("dropzone").files,a=b[b.length-1],c=new FormData,c.append("photo",a),e=new XMLHttpRequest,e.open("POST",window.API_SUBMIT_PHOTO,!0),d=this,e.onload=function(a){return function(){var b;return b=e.responseText,b=JSON.parse(b),a.photoSubmitProgress("end"),"OK"===b.status?a.photoSubmitSuccess(b):a.photoSubmitError(b)}}(this),e.setRequestHeader("Accept","application/json"),e.setRequestHeader("Cache-Control","no-cache"),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("X-File-Name",a.name),this.photoSubmitProgress("start"),e.send(c),!1},a.prototype.startProgressBar=function(){return $jQ("#bt-submit-photo").addClass("upprogress"),window.upinterval=setInterval(function(a){return function(){var b;return a.idx=(a.idx+1)%a.opts.length,b=a.opts[a.idx],$jQ("#bt-submit-photo").text(b)}}(this),this.delta),console.log(window.upinterval)},a.prototype.stopProgressBar=function(){return clearInterval(window.upinterval),$jQ("#bt-submit-photo").text("ok \\o/"),setTimeout(function(){return $jQ("#bt-submit-photo").removeClass("upprogress").text("upload")},1500)},a.prototype.photoSubmitProgress=function(a){return"start"===a?(this.upprogress=!0,this.startProgressBar()):"end"===a?(this.upprogress=!1,this.stopProgressBar()):void 0},a.prototype.photoSubmitSuccess=function(){return setTimeout(function(){return overlay.hide(0)},1e3)},a.prototype.photoSubmitError=function(){return $jQ("#photo-submit").css({"border-color":"#ff0000"})},a}(),b.exports=c},{}],5:[function(a,b){var c,d=function(a,b){return function(){return a.apply(b,arguments)}};c=function(){function a(a,b){this.parent=a,this.el=b,this.stop=d(this.stop,this),this.previewCanceled=d(this.previewCanceled,this),this.previewComplete=d(this.previewComplete,this),this.uploadedError=d(this.uploadedError,this),this.uploadedSuccessful=d(this.uploadedSuccessful,this),this.initComplete=d(this.initComplete,this),this.embedComplete=d(this.embedComplete,this),this.start=d(this.start,this)}return a.prototype.start=function(){return swfobject.switchOffAutoHideShow(),swfobject.registerObject("openbooth","9"),window.openbooth_options={enableSound:!0,enableFlash:!0,enableSettingsButton:!0,bandwidth:0,photoQuality:100,photoWidth:459,photoHeight:344,cameraWidth:459,cameraHeight:344,cameraFPS:25,timerTimeout:3,timerX:198,timerY:250,timerAlpha:.6,callbacks:{initComplete:this.initComplete,uploadSuccessful:this.uploadSuccessfull,onError:this.uploadError,previewComplete:this.previewComplete,previewCanceled:this.previewCanceled,videoStart:!1,noVideoDevices:!1,uploadComplete:!1},placeholders:{load:"/images/openbooth_allow_dev.jpg",save:"/images/openbooth_saving_dev.jpg",noVideoDevices:"/images/openbooth_nocameras_dev.jpg"}},window.openbooth=swfobject.getObjectById("openbooth"),this.openbooth=window.openbooth},a.prototype.embedComplete=function(){return console.log("Embed complete, calling openbooth.init()"),console.log(this.openbooth),this.openbooth.init(window.openbooth_options),this.openbooth.camInit(),console.log("Called. Waiting for init")},a.prototype.initComplete=function(){console.log("Init completed"),this.openbooth.camInit()},a.prototype.uploadedSuccessful=function(){},a.prototype.uploadedError=function(){},a.prototype.previewComplete=function(){},a.prototype.previewCanceled=function(){},a.prototype.stop=function(){},a}(),b.exports=c},{}],6:[function(a,b){var c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}};d=a("./PhotoUpload.coffee"),e=a("./Photobooth.coffee"),c=function(){function a(a){this.hide=f(this.hide,this),this.show=f(this.show,this),this.setPage=f(this.setPage,this),this.el=$jQ(a),this.pages=["photobooth","mostraoteu"],this.controllers=[new e(this,this.el),new d(this,this.el)],this.el.css({width:WIDTH,height:HEIGHT}),this.on=!1,this.init=!1}return a.prototype.getController=function(a){return this.controllers[this.pages.lastIndexOf(a)]},a.prototype.getActiveController=function(){return this.controllers[this.pages.lastIndexOf(this.cpage_name)]},a.prototype.setPage=function(a){return this.cpage&&this.cpage.hide(),this.cpage=$jQ("#"+a),this.cpage_name=a,this.cobj=this.controllers[this.pages.lastIndexOf(a)],this.init?void 0:(this.cobj.start(),this.init=!0)},a.prototype.show=function(){return this.el.show().transition({opacity:1}),this.cpage.show(),this.on=!0},a.prototype.hide=function(){return this.el.transition({opacity:0}).queue(this.cobj?function(){var a;return $jQ(this).hide().dequeue(),null!=(a=this.cobj)&&"function"==typeof a.on_hide_complete?a.on_hide_complete():void 0}:function(){return $jQ(this).hide().dequeue()}),this.on=!1,this.cobj?this.cobj.stop():void 0},a}(),b.exports=c},{"./PhotoUpload.coffee":4,"./Photobooth.coffee":5}]},{},[2]);